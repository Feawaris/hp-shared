import{s as Q,a as M,b as X,D as H,c as Z,S as I,d as tt,e as et}from"./chunk-EUWEJB4K-dEG6T5rI.js";import{r as ot}from"./chunk-ANTO7JYN-CB0ZuPI5.js";import{_ as S,l as E,d as C,A as st,j as rt,e as w}from"./mermaid.core-m-CcQ0GJ.js";import{G as at}from"./graph-DgIJdkDY.js";import{d as R}from"./transform-Dgtl54Jv.js";import"./clone-kXfG3nCd.js";import"./chunk-QOU2KDNW-CCbsiCnq.js";import"./line-BwvnvHaK.js";import"./array-DEnAxiAM.js";import"./path-CbwjOpE9.js";import"./point-DWREGWZc.js";import"./layout-R_S9QOUc.js";import"./app-_TbYwccm.js";import"./commonjsHelpers-Cpj98o6Y.js";var h="rect",$="rectWithTitle",it="start",nt="end",lt="divider",ct="roundedWithTitle",dt="note",Et="noteGroup",u="statediagram",St="state",_t=`${u}-${St}`,U="transition",Tt="note",pt="note-edge",ut=`${U} ${pt}`,ft=`${u}-${Tt}`,Dt="cluster",vt=`${u}-${Dt}`,bt="cluster-alt",At=`${u}-${bt}`,V="parent",Y="note",ht="state",N="----",yt=`${N}${Y}`,m=`${N}${V}`,W="fill:none",z="fill: #333",j="c",q="text",K="normal",y={},d=0,gt=S(function(t){const r=Object.keys(t);for(const e of r)t[e]},"setConf"),Ct=S(function(t,r){return r.db.extract(r.db.getRootDocV2()),r.db.getClasses()},"getClasses");function F(t){return t==null?"":t.classes?t.classes.join(" "):""}S(F,"getClassesFromDbInfo");function g(t="",r=0,e="",a=N){const i=e!==null&&e.length>0?`${a}${e}`:"";return`${ht}-${t}${i}-${r}`}S(g,"stateDomId");var A=S((t,r,e,a,i,n)=>{const o=e.id,f=F(a[o]);if(o!=="root"){let T=h;e.start===!0&&(T=it),e.start===!1&&(T=nt),e.type!==H&&(T=e.type),y[o]||(y[o]={id:o,shape:T,description:w.sanitizeText(o,C()),classes:`${f} ${_t}`});const s=y[o];e.description&&(Array.isArray(s.description)?(s.shape=$,s.description.push(e.description)):s.description.length>0?(s.shape=$,s.description===o?s.description=[e.description]:s.description=[s.description,e.description]):(s.shape=h,s.description=e.description),s.description=w.sanitizeTextOrArray(s.description,C())),s.description.length===1&&s.shape===$&&(s.shape=h),!s.type&&e.doc&&(E.info("Setting cluster for ",o,G(e)),s.type="group",s.dir=G(e),s.shape=e.type===Z?lt:ct,s.classes=s.classes+" "+vt+" "+(n?At:""));const p={labelStyle:"",shape:s.shape,labelText:s.description,classes:s.classes,style:"",id:o,dir:s.dir,domId:g(o,d),type:s.type,padding:15};if(p.centerLabel=!0,e.note){const l={labelStyle:"",shape:dt,labelText:e.note.text,classes:ft,style:"",id:o+yt+"-"+d,domId:g(o,d,Y),type:s.type,padding:15},c={labelStyle:"",shape:Et,labelText:e.note.text,classes:s.classes,style:"",id:o+m,domId:g(o,d,V),type:"group",padding:0};d++;const D=o+m;t.setNode(D,c),t.setNode(l.id,l),t.setNode(o,p),t.setParent(o,D),t.setParent(l.id,D);let _=o,v=l.id;e.note.position==="left of"&&(_=l.id,v=o),t.setEdge(_,v,{arrowhead:"none",arrowType:"",style:W,labelStyle:"",classes:ut,arrowheadStyle:z,labelpos:j,labelType:q,thickness:K})}else t.setNode(o,p)}r&&r.id!=="root"&&(E.trace("Setting node ",o," to be child of its parent ",r.id),t.setParent(o,r.id)),e.doc&&(E.trace("Adding nodes children "),xt(t,e,e.doc,a,i,!n))},"setupNode"),xt=S((t,r,e,a,i,n)=>{E.trace("items",e),e.forEach(o=>{switch(o.stmt){case tt:A(t,r,o,a,i,n);break;case H:A(t,r,o,a,i,n);break;case I:{A(t,r,o.state1,a,i,n),A(t,r,o.state2,a,i,n);const f={id:"edge"+d,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:W,labelStyle:"",label:w.sanitizeText(o.description,C()),arrowheadStyle:z,labelpos:j,labelType:q,thickness:K,classes:U};t.setEdge(o.state1.id,o.state2.id,f,d),d++}break}})},"setupDoc"),G=S((t,r=et)=>{let e=r;if(t.doc)for(let a=0;a<t.doc.length;a++){const i=t.doc[a];i.stmt==="dir"&&(e=i.value)}return e},"getDir"),Rt=S(async function(t,r,e,a){E.info("Drawing state diagram (v2)",r),y={},a.db.getDirection();const{securityLevel:i,state:n}=C(),o=n.nodeSpacing||50,f=n.rankSpacing||50;E.info(a.db.getRootDocV2()),a.db.extract(a.db.getRootDocV2()),E.info(a.db.getRootDocV2());const T=a.db.getStates(),s=new at({multigraph:!0,compound:!0}).setGraph({rankdir:G(a.db.getRootDocV2()),nodesep:o,ranksep:f,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});A(s,void 0,a.db.getRootDocV2(),T,a.db,!0);let p;i==="sandbox"&&(p=R("#i"+r));const l=i==="sandbox"?R(p.nodes()[0].contentDocument.body):R("body"),c=l.select(`[id="${r}"]`),D=l.select("#"+r+" g");await ot(D,s,["barb"],u,r);const _=8;st.insertTitle(c,"statediagramTitleText",n.titleTopMargin,a.db.getDiagramTitle());const v=c.node().getBBox(),L=v.width+_*2,P=v.height+_*2;c.attr("class",u);const O=c.node().getBBox();rt(c,P,L,n.useMaxWidth);const k=`${O.x-_} ${O.y-_} ${L} ${P}`;E.debug(`viewBox ${k}`),c.attr("viewBox",k);const J=document.querySelectorAll('[id="'+r+'"] .edgeLabel .label');for(const x of J){const B=x.getBBox(),b=document.createElementNS("http://www.w3.org/2000/svg",h);b.setAttribute("rx",0),b.setAttribute("ry",0),b.setAttribute("width",B.width),b.setAttribute("height",B.height),x.insertBefore(b,x.firstChild)}},"draw"),$t={setConf:gt,getClasses:Ct,draw:Rt},Wt={parser:Q,db:M,renderer:$t,styles:X,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,M.clear()}};export{Wt as diagram};
